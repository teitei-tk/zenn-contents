---
title: "ä½œã£ã¦å­¦ã¶Ruby3 é™çš„è§£æãƒ»RBSå…¥é–€"
emoji: "ğŸ“‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["ruby", "steep", "rbs"]
published: true
---

# Ruby 3 ã®é™çš„å‹è§£æã«ã¤ã„ã¦

ç§ãŒæ¥­å‹™ã§ Ruby ã‚’æ›¸ã„ã¦ã„ãŸæ™‚æœŸã¯æ•°å¹´å‰ã§æœ€è¿‘ã® Ruby ã«ã¤ã„ã¦ã‚­ãƒ£ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒé…ã‚Œã¦ã„ã¾ã—ãŸã€‚
æœ€è¿‘ã¯ Goãƒ»TypeScript ãªã©å‹ã‚’æ›¸ãã“ã¨ãŒã»ã¨ã‚“ã©ãªã®ã§ Ruby 3 ç³»ã§å°å…¥ã•ã‚ŒãŸå‹è§£æã«ã¤ã„ã¦æ°—ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚
Ruby ã£ã¦å‹ãŒç„¡ã„ã‚ˆã­ã¨è‚©èº«ãŒç‹­ã„ç”Ÿæ´»ã‚’ã—ã¦ã„ã‚‹ã®ã§(å‹ã ã‘ã«)ã€Ruby ã§ã‚‚å‡ºæ¥ã‚‰ã‚ã£ï¼ã¨ã„ã†ã¨ã“ã‚ã‚’è¦‹ã›ãŸã„ã¨è€ƒãˆæ›¸ã„ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

# ä½œã‚‹ã‚‚ã®

[HackerNews API](https://hackernews.api-docs.io/v0/overview/introduction) ã‚’åˆ©ç”¨ã—ã¦ HackerNews ã® API Client ã‚’ä½œã‚Šã¾ã™ã€‚è¦ä»¶ã¯ä»¥ä¸‹ã§ã™ã€‚

1. gem ã¨ã—ã¦å®Ÿè£…ã™ã‚‹
   ã“ã‚Œã¯ãªã‚“ã‚„ã‹ã‚“ã‚„ã§ç§ãŒ gem ã‚’æ›¸ã„ãŸã“ã¨ãŒãªã„ã®ã§å‹‰å¼·ã®ä¸€ç’°ã§ã™ã€‚ç‰¹ã« gem ã§æ›¸ãå¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“

2. rake ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã¨ Hacker News ã®ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«ç›¸å½“ã™ã‚‹æƒ…å ±(ã‚¿ã‚¤ãƒˆãƒ«, points, author, æ—¥ä»˜)ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã€‚ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã¯å®Ÿè£…ã—ãªã„
3. å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã«å‹æƒ…å ±ã‚’ã¤ã‘ã‚‹
   å‹æƒ…å ±ã¨ã„ã†ã®ã¯ RBS ãƒ•ã‚¡ã‚¤ãƒ«ã®ã“ã¨ã§ã™

4. é™çš„è§£æãƒ„ãƒ¼ãƒ«ã¯ Steep ã‚’åˆ©ç”¨ã™ã‚‹

# ä½œã£ãŸã‚‚ã®

ãƒã‚¿ãƒãƒ¬ã§ã™ãŒå®Œæˆç³»ã®ã‚½ãƒ¼ã‚¹ã¯ã“ã¡ã‚‰ã§ã™ã€‚
https://github.com/teitei-tk/hackernews_api_client_rb

# gem ã®ä½œæˆ

Ruby ã¯ `3.2.1` ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

```sh
$ ruby --version
ruby 3.2.1 (2023-02-08 revision 31819e82c8) [arm64-darwin22]
```

```sh
$ bundle gem hackernews_api_client
```

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ `sig` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™

```sh
$ tree
.
â”œâ”€â”€ CHANGELOG.md
â”œâ”€â”€ CODE_OF_CONDUCT.md
â”œâ”€â”€ Gemfile
â”œâ”€â”€ LICENSE.txt
â”œâ”€â”€ README.md
â”œâ”€â”€ Rakefile
â”œâ”€â”€ bin
â”‚Â Â  â”œâ”€â”€ console
â”‚Â Â  â””â”€â”€ setup
â”œâ”€â”€ hackernews_api_client.gemspec
â”œâ”€â”€ lib
â”‚Â Â  â”œâ”€â”€ hackernews_api_client
â”‚Â Â  â”‚Â Â  â””â”€â”€ version.rb
â”‚Â Â  â””â”€â”€ hackernews_api_client.rb
â”œâ”€â”€ sig
â”‚Â Â  â””â”€â”€ hackernews_api_client.rbs
â””â”€â”€ spec
    â”œâ”€â”€ hackernews_api_client_spec.rb
    â””â”€â”€ spec_helper.rb

5 directories, 14 files
```

å‹å®šç¾©ã‚’ã¾ã¨ã‚ã‚‹ Steepfile ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```sh
$ bundle add steep
$ bundle exec steep init
Writing Steepfile...
```

```sh
$ ls | grep Steepfile
Steepfile
```

Steepfile ãŒç”Ÿæˆã•ã‚Œã‚‹ã®ã§ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã® `lib/` ã¨ `Gemfile` ã‚’å¯¾è±¡ã«ã—ã¾ã™ã€‚

```rbs
# D = Steep::Diagnostic
#
target :lib do
  signature "sig"

  check "lib"                       # Directory name
  check "Gemfile"                   # File name
  # ignore "lib/templates/*.rb"

  # library "pathname", "set"       # Standard libraries
  # library "strong_json"           # Gems

  # configure_code_diagnostics(D::Ruby.strict)       # `strict` diagnostics setting
  # configure_code_diagnostics(D::Ruby.lenient)      # `lenient` diagnostics setting
  # configure_code_diagnostics do |hash|             # You can setup everything yourself
  #   hash[D::Ruby::NoMethod] = :information
  # end
end

# target :test do
#   signature "sig", "sig-private"
#
#   check "test"
#
#   # library "pathname", "set"       # Standard libraries
# end
```

# è§¦ã‚Œã¦ã¿ã‚‹

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç”Ÿæˆã•ã‚ŒãŸ rbs ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ `HackernewsApiClient::VERSION` ã®å‹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’ Integer ã«å¤‰æ›´ã—ã¦ã¿ã¾ã™ã€‚

```rbs
module HackernewsApiClient
  VERSION: String
  # See the writing guide of rbs: https://github.com/ruby/rbs#guides
end
```

```sh
$ bundle exec steep check
# Type checking files:

.......................................................F..........................F

lib/hackernews_api_client.rb:6:8: [warning] Cannot find the declaration of class: `Error`
â”‚ Diagnostic ID: Ruby::UnknownConstant
â”‚
â””   class Error < StandardError; end
          ~~~~~

lib/hackernews_api_client/version.rb:4:2: [error] Cannot assign a value of type `::Integer` to a constant of type `::String`
â”‚   ::Integer <: ::String
â”‚     ::Numeric <: ::String
â”‚       ::Object <: ::String
â”‚         ::BasicObject <: ::String
â”‚
â”‚ Diagnostic ID: Ruby::IncompatibleAssignment
â”‚
â””   VERSION = 1
    ~~~~~~~~~~~

Detected 2 problems from 2 files
```

å®šç¾©ã•ã‚Œã¦ã„ãªã„ Error ã¨ã€VERSION ãŒ Integer ã§ã‚ã‚‹ã‚¨ãƒ©ãƒ¼ãŒå‡ºåŠ›ã•ã‚Œã¾ã—ãŸã€‚

# VSCode ã¨ã®é€£æº

steep ã«ã¯ VSCode ã®æ‹¡å¼µãŒã‚ã‚Šã€steep-vscode ã‚’å°å…¥ã™ã‚‹ã“ã¨ã§ã‚¨ãƒ©ãƒ¼ã‹ã‚‰ã•ã‚‰ã«å‹è£œå®Œã¾ã§ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
https://marketplace.visualstudio.com/items?itemName=soutaro.steep-vscode

![](/images/9787347abceb02/steep_vscode_error.png)
![](/images/9787347abceb02/steep_vscode_type_completion.png)

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å®šç¾©

æ¬¡ã« Logger ã‚’å®Ÿè£…ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚å®Ÿè£…å†…å®¹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

```ruby
require "logger"

module HackernewsApiClient
  class Logger < ::Logger
    def self.default
      return @default if @default

      logger = new STDOUT
      logger.level = Logger::WARN
      @default = logger
    end
  end
end
```

ãŒã€ã“ã®ã‚³ãƒ¼ãƒ‰ã ã¨æ¨™æº–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® `Logger` Class ã‚’è§£æã§ããšã€`UnknownConstant` ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

```sh
$ bundle exec steep check
# Type checking files:

..........................................F.........................................

lib/hackernews_api_client/logger.rb:4:8: [warning] Cannot find the declaration of class: `Logger`
â”‚ Diagnostic ID: Ruby::UnknownConstant
â”‚
â””   class Logger < ::Logger
          ~~~~~~

lib/hackernews_api_client/logger.rb:4:19: [warning] Cannot find the declaration of class: `Logger`
â”‚ Diagnostic ID: Ruby::UnknownConstant
â”‚
â””   class Logger < ::Logger
                     ~~~~~~

lib/hackernews_api_client/logger.rb:8:19: [error] Unexpected positional argument
â”‚ Diagnostic ID: Ruby::UnexpectedPositionalArgument
â”‚
â””       logger = new STDOUT
                     ~~~~~~

lib/hackernews_api_client/logger.rb:9:21: [warning] Cannot find the declaration of constant: `Logger`
â”‚ Diagnostic ID: Ruby::UnknownConstant
â”‚
â””       logger.level = Logger::WARN
                       ~~~~~~

lib/hackernews_api_client/logger.rb:9:13: [error] Type `::Object` does not have method `level=`
â”‚ Diagnostic ID: Ruby::NoMethod
â”‚
â””       logger.level = Logger::WARN
               ~~~~~

lib/hackernews_api_client/logger.rb:10:6: [error] Cannot find the declaration of instance variable: `@default`
â”‚ Diagnostic ID: Ruby::UnknownInstanceVariable
â”‚
â””       @default = logger
        ~~~~~~~~

Detected 6 problems from 1 file
```

Ruby ã®æ¨™æº–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ Steep ã«ç†è§£ã•ã›ã‚‹ã«ã¯ Steepfile ã® `library` ã«è¿½åŠ ã‚’ã—ã¾ã™ã€‚

```diff
diff --git a/Steepfile b/Steepfile
index 2ff289b..e5d1548 100644
--- a/Steepfile
+++ b/Steepfile
@@ -4,6 +4,7 @@ target :lib do
   signature "sig"

   check "lib"                       # Directory name
+  library "logger"
   # check "Gemfile"                   # File name
   # ignore "lib/templates/*.rb"
```

è¿½åŠ ã™ã‚‹ã“ã¨ã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ç†è§£ã—ãŸã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

```sh
$ bundle exec steep check
# Type checking files:

........................................................F.................................

lib/hackernews_api_client/logger.rb:10:6: [error] Cannot find the declaration of instance variable: `@default`
â”‚ Diagnostic ID: Ruby::UnknownInstanceVariable
â”‚
â””       @default = logger
        ~~~~~~~~

Detected 1 problem from 1 file
```

# RBS ãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè£…

ç¶šã„ã¦ `logger.rb` ã® RBS ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ã“ã“ã§ 1 ã‹ã‚‰å®Ÿè£…ã—ã¦ã‚‚è‰¯ã„ã®ã§ã™ãŒã€å…ƒã¨ãªã‚‹ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹å ´åˆã¯ `TypeProf` ã‚’åˆ©ç”¨ã—ã¦ RBS ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚ `TypeProf` ã¨ã„ã†ã®ã¯ Ruby ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è§£æã—ã€å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ãƒ«ã®ã“ã¨ã§ã™ã€‚

```sh
$ typeprof lib/hackernews_api_client/logger.rb
# TypeProf 0.21.3

# Classes
module HackernewsApiClient
  class Logger < Logger
    self.@default: Logger

    def self.default: -> Logger?
  end
end
```

`-o` ã§ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ãŒã§ãã¾ã™ã€‚

```sh
$ typeprof lib/hackernews_api_client/logger.rb -o sig/logger.rbs
```

ãŒã€å®Œç’§ã§ã¯ãªãã“ã®ã¾ã¾ã ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

```sh
$ bundle exec steep check
# Type checking files:

........................................F.................................................F

lib/hackernews_api_client/logger.rb:4:2: [error] UnexpectedError: sig/logger.rbs:5:2...9:5: Detected recursive ancestors: ::HackernewsApiClient::Logger < ::HackernewsApiClient::Logger
â”‚ Diagnostic ID: Ruby::UnexpectedError
â”‚
â””   class Logger < ::Logger
    ~~~~~~~~~~~~~~~~~~~~~~~

sig/logger.rbs:5:2: [error] Circular inheritance/mix-in is detected: ::HackernewsApiClient::Logger <: ::HackernewsApiClient::Logger
â”‚ Diagnostic ID: RBS::RecursiveAncestor
â”‚
â””   class Logger < Logger
    ~~~~~~~~~~~~~~~~~~~~~

Detected 2 problems from 2 files
```

rbs ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã‚‹ã¨ã‚ã‹ã‚‹ã®ã§ã™ãŒã€`Logger` Class ã®æŒ‡å®šãŒçµ¶å¯¾æŒ‡å®šã§ã¯ãªã„ã®ãŒåŸå› ã§ã™ã€‚çµ¶å¯¾æŒ‡å®šã«ç›´ã™ã¨ã‚¨ãƒ©ãƒ¼ãŒä¿®æ­£ã•ã‚Œã¾ã—ãŸã€‚

```sh
$ bundle exec steep check
# Type checking files:

...........................................................................................

No type error detected. ğŸ«–
```

# å¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®åˆ©ç”¨

HTTP Client ã¨ã—ã¦ Faraday ã‚’åˆ©ç”¨ã—ãŸã„ã®ã§ gemspec ã‚’æ›´æ–°ã—ã¾ã™ã€‚

```sh
$ git diff
diff --git a/hackernews_api_client.gemspec b/hackernews_api_client.gemspec
index 3069b32..41f9c90 100644
--- a/hackernews_api_client.gemspec
+++ b/hackernews_api_client.gemspec
@@ -29,7 +29,7 @@ Gem::Specification.new do |spec|
   spec.require_paths = ["lib"]

   # Uncomment to register a new dependency of your gem
-  # spec.add_dependency "example-gem", "~> 1.0"
+  spec.add_dependency "faraday", "~> 2.7"

   # For more information and examples about making a new gem, check out our
   # guide at: https://bundler.io/guides/creating_gem.html
```

Faraday ã® connection ã‚’å®šç¾©ã—ã¾ã™ã€‚

```ruby
# frozen_string_literal: true

module HackernewsApiClient
  module Faraday
    module Connection
      private

      def connection
        @connection ||=
          begin
            options = {
              headers: {
                'Accept' => 'application/json; charset=utf-8',
                'User-Agent' => "HackerNews Ruby Client/#{HackernewsApiClient::VERSION}"
              }
            }

            url = "https://hacker-news.firebaseio.com"
            ::Faraday.new(url, options) do |connection|
              connection.request :multipart
              connection.request :url_encoded
              connection.response :json, content_type: /\b*$/
              connection.response :logger, HackernewsApiClient::Logger.default
              connection.adapter ::Faraday.default_adapter
            end
          end
      end
    end
  end
end
```

å…ˆã»ã©ã¨åŒæ§˜ã« TypeProf ã‚’åˆ©ç”¨ã—ã¦ RBS ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã—ã¦ã¿ã¾ã™ã€‚

```rbs
$ typeprof lib/hackernews_api_client/faraday/connection.rb
# TypeProf 0.21.3

# Classes
module HackernewsApiClient
  module Faraday
    module Connection
      @connection: untyped

      private
      def connection: -> untyped
    end
  end
end
```

`@connection`ãŒ untyped ã¨ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚ã“ã‚Œã‚‚å½“ç„¶ã§ Steepfile ã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å®šç¾©ã—ã¦ã„ãªã„ãŸã‚ã€è§£æã§ããš untyped ã«ãªã‚Šã¾ã™ã€‚

æ¨™æº–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä»¥å¤–ã®å‹æƒ…å ±ã¯ `gem_rbs_collection` ã¨ã„ã†ãƒªãƒã‚¸ãƒˆãƒªã«ã¾ã¨ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚
https://github.com/ruby/gem_rbs_collection

Ruby 3.1 ä»¥å‰ã§ã¯å‹æ¤œæŸ»ã®ãŸã‚ãƒ­ãƒ¼ã‚«ãƒ«ã«å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸãŒã€3.1 ã‹ã‚‰ã¯ `rbs collection` ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè£…ã•ã‚Œã¾ã—ãŸã€‚
ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ Gemfile ã‹ã‚‰ä¾å­˜ã™ã‚‹ Gem ã‚’è§£æã—ã€`steep`ã‚„`TypeProf`ã‚’åˆ©ç”¨ã—ãŸéš›ã®ä¾å­˜æ€§ã‚‚è§£æ±ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```sh
$ bundle exec rbs collection init
created: rbs_collection.yaml
teitei.tk >> !(main) ~/repos/src/github.com/teitei-tk/hackernews_api_client
$ cat rbs_collection.yaml
# Download sources
sources:
  - name: ruby/gem_rbs_collection
    remote: https://github.com/ruby/gem_rbs_collection.git
    revision: main
    repo_dir: gems

# A directory to install the downloaded RBSs
path: .gem_rbs_collection

gems:
  # Skip loading rbs gem's RBS.
  # It's unnecessary if you don't use rbs as a library.
  - name: rbs
    ignore: true
```

`rbs_collection.yaml`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯ Gem ã§ã„ã†ã¨ã“ã‚ã® Gemfile ã«ãªã‚Šã¾ã™ã€‚

å‰è¿°ã®é€šã‚Š Gemfile ã‚’èª­ã‚“ã§ä¾å­˜é–¢ä¿‚ã‚’è¦‹ã¦ã„ã¾ã™ã€‚ä»Šå›ã¯ gem ã¨ã—ã¦å®Ÿè£…ã—ã¦ãŠã‚Šã€ãã®ã¾ã¾ã§ã¯ rbs ã®å®šç¾©ãŒäºŒé‡ã«ãªã£ã¦ã—ã¾ã„ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚ã•ã‚‰ã« steep gem ã‚‚è§£æã™ã‚‹ã‚ˆã†ã«ãªã‚Šã‚¨ãƒ©ãƒ¼ã¨ãªã‚‹ã®ã§ã€ignore ã‚’è¿½åŠ ã—ã€è§£æå¯¾è±¡ã‹ã‚‰å¤–ã™æ§˜ã«ã—ã¾ã™ã€‚

```yaml
# Download sources
sources:
  - name: ruby/gem_rbs_collection
    remote: https://github.com/ruby/gem_rbs_collection.git
    revision: main
    repo_dir: gems

# A directory to install the downloaded RBSs
path: .gem_rbs_collection

gems:
  # Skip loading rbs gem's RBS.
  # It's unnecessary if you don't use rbs as a library.
  - name: rbs
    ignore: true
  - name: steep
    ignore: true
  - name: hackernews_api_client
    ignore: true
  - name: logger
  - name: faraday
```

Steepfile ã« `collection_config` ã‚’è¿½åŠ ã—ã€ `rbs_collection.yaml` ã¸ã®ãƒ‘ã‚¹ã‚’å®šç¾©ã—ã¾ã™ã€‚å‰è¿°ã«è¿½åŠ ã—ãŸ `library` ã‚‚å‰Šé™¤ã—ã€`rbs_collection.yaml` ã«å‹å®šç¾©ã‚’çµ±ä¸€ã—ã¾ã™ã€‚

```Steepfile
# D = Steep::Diagnostic
#
target :lib do
  signature "sig"

  check "lib"                       # Directory name
  collection_config "rbs_collection.yaml"
  # check "Gemfile"                   # File name
  # ignore "lib/templates/*.rb"

  # library "pathname", "set"       # Standard libraries
  # library "strong_json"           # Gems

  # configure_code_diagnostics(D::Ruby.strict)       # `strict` diagnostics setting
  # configure_code_diagnostics(D::Ruby.lenient)      # `lenient` diagnostics setting
  # configure_code_diagnostics do |hash|             # You can setup everything yourself
  #   hash[D::Ruby::NoMethod] = :information
  # end
end

# target :test do
#   signature "sig", "sig-private"
#
#   check "test"
#
#   # library "pathname", "set"       # Standard libraries
# end
```

æœ€å¾Œã«ã€install ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã«å‹æƒ…å ±ãŒå–å¾—ã•ã‚Œã¾ã™ã€‚

```sh
$ bundle exec rbs collection install
```

install å¾Œã€typeprof ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨å‹ãŒèªè­˜ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

```rbs
$ typeprof lib/hackernews_api_client/faraday/connection.rb
# TypeProf 0.21.3

# Classes
module HackernewsApiClient
  module Faraday
    module Connection
      @connection: Faraday::Connection

      private
      def connection: -> Faraday::Connection
    end
  end
end
```

ã‚ã¨ã¯ã‚´ãƒªã‚´ãƒªé–‹ç™ºã‚’ã™ã‚‹ã ã‘ã§ã™ã€‚ãã—ã¦å‡ºæ¥ä¸ŠãŒã£ãŸã‚‚ã®ãŒã“ã¡ã‚‰ã§ã™
https://github.com/teitei-tk/hackernews_api_client_rb

# æ‰€ç®¡

## ãƒã‚¬ãƒ†ã‚£ãƒ–ãªç‚¹

### ç™»å ´äººç‰©ãŒå¤šã„

Ruby ã®é™çš„è§£æãƒ„ãƒ¼ãƒ«å‘¨ã‚Šã ã‘ã§ã‚‚ 5 ã¤ã¯ã‚ã‚‹ã®ã§ãƒ‘ãƒƒã¨ç†è§£ã™ã‚‹ã®ãŒé›£ã—ã„å°è±¡ã‚’å—ã‘ã¾ã—ãŸã€‚

1. rbs
2. rbs collection
3. steep
4. sorbet
5. TypeProf

### ã¡ã‚‡ã£ã¨æ»ã£ãŸæ›¸ãæ–¹ã‚’ã™ã‚‹ã¨å‹å®šç¾©ã®æ›¸ãæ–¹ãŒåˆ†ã‹ã‚‰ãªã„

Web ä¸Šã«å­˜åœ¨ã™ã‚‹è¨˜äº‹ã®å¤§ä½“ãŒè§¦ã£ã¦ã¿ãŸãƒ¬ãƒ™ãƒ«ãªã®ã§æ»ã£ãŸæ›¸ãæ–¹(ãƒ¡ã‚¿ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ç­‰)ã‚’ã™ã‚‹å ´åˆã€å‹å®šç¾©ãŒåˆ†ã‹ã‚‰ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
ã¾ã ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ãŒå›ºã¾ã£ã¦ã„ãªã„å°è±¡ã§ã—ãŸã€‚

### rbs collection ã«ã‚ã‚‹ gem ã®æ•°ãŒå°‘ãªã„

ã“ã‚Œã¯æˆ‘ã€…ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®å•é¡Œã§ã™ãŒã€æ¯”è¼ƒçš„ã‚ˆãåˆ©ç”¨ã™ã‚‹ã§ã‚ã‚ã† `aws-sdk`, `activerecord` ã¨ã„ã£ãŸ gem ã¯å­˜åœ¨ã—ã¾ã™ãŒã€ã¾ã ã¾ã æ•°ãŒå°‘ãªã„ã®ã§å°‘ã—ã§ã‚‚ãƒã‚¤ãƒŠãƒ¼ãª gem ã‚’åˆ©ç”¨ã—ã‚ˆã†ã¨è€ƒãˆã‚‹ã¨æ©æµã«æˆã‹ã‚Šã¥ã‚‰ã„ã§ã™ã€‚
https://github.com/ruby/gem_rbs_collection/tree/main/gems

## ãƒã‚¸ãƒ†ã‚£ãƒ–ãªç‚¹

### ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚‚åˆ©ç”¨ã§ãã‚‹

ã—ã°ã‚‰ã Ruby ã‹ã‚‰é›¢ã‚Œã¦ãŠã‚Šæƒ…å ±ã‚’è¿½ã„ãã‚Œã¦ãŠã‚‰ãšãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã§åˆ©ç”¨ã™ã‚‹ã®ã¯ã¾ã å…ˆã‹ãªã¨å‹æ‰‹ã«æ€ã£ã¦ã„ã¾ã—ãŸãŒã€å‘¨è¾ºãƒ„ãƒ¼ãƒ«ãŒæ•´ã£ã¦ã„ã‚‹ã“ã¨ã‚‚ã‚ã‚Šãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚‚åˆ©ç”¨ã§ãã‚‹ã¨åˆ¤æ–­ã—ã¾ã—ãŸã€‚
rbs collection ã‚„ VSCode ã® Extension ãªã©å‘¨è¾ºãƒ„ãƒ¼ãƒ«ã¯ã‹ãªã‚Šæ•´ã£ã¦ã„ã‚‹å°è±¡ã§ã—ãŸã€‚

ã˜ã‚ƒã‚å¤šãã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã§åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã§ã‚ã‚ã† Rails ã¯ã©ã†ã ã¨ã„ã†è©±ã§ã™ãŒã€ã¾ã è¾›ã„éƒ¨åˆ†ã¯ã‚ã‚‹ã‚‚ã®ã®å°å…¥ã—ã¦å‹ã®æ©æµã‚’å—ã‘ã‚‹ã“ã¨ã¯ã§ããã†ã¨è€ƒãˆã¦ã„ã¾ã™

https://blog.agile.esm.co.jp/entry/example-of-introducing-and-using-rbs

# æœ€å¾Œã«

æ€ã£ãŸä»¥ä¸Šã«é“ã¯æ•´ã£ã¦ã„ãŸã®ã§ã‚ã¨ã¯ã²ãŸã™ã‚‰æ›¸ãã ã‘ã ãªã¨ã„ã†å°è±¡ã§ã—ãŸã€‚ä¸€æ–¹å®Ÿéš›ã®æ¥­å‹™ã§åˆ©ç”¨ã—ã¦ã„ã‚‹ Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å°å…¥ã™ã‚‹ã«ã¯ä¸€è‹¦åŠ´å¿…è¦ã«ãªã‚Šãã†ã¨ã„ã†æ„Ÿæƒ³ã§ã™ã€‚
ç§ãŒå°å…¥ã™ã‚‹ã®ã§ã‚ã‚Œã°ä¸€æ°—ã«å°å…¥ã™ã‚‹ã®ã§ã¯ãªãã€å°‘ã—ãšã¤å‹å®šç¾©ã‚’åæ˜ ã—ã¦ã„ãã‚„ã‚Šæ–¹ã«ãªã‚‹ã ã‚ã†ã¨è€ƒãˆã¾ã—ãŸ(`app/`ã‚’å…¨ã¦ã¿ã‚‹ã®ã§ã¯ãªãã€`app/controllers/hoge_controller`ãªã©ä¸€ã¤ãšã¤é©å¿œã¨ã„ã†æ–¹é‡ã§ã™ã€‚)
ã¾ãŸã¯å…¨ã¦ã«å‹å®šç¾©ã‚’åæ˜ ã™ã‚‹ã“ã¨ã¯å¾Œå›ã—ã«ã—ã€é‡è¦ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ã‚³ãƒ¼ãƒ‰(èª²é‡‘å‡¦ç†ãƒ»ãƒãƒƒãƒå‡¦ç† etc)ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ gem ã«åˆ‡ã‚Šå‡ºã—ã€ã²ã¨ã¾ãšãã“ã ã‘ãƒ¡ãƒ³ãƒ†ãƒŠã‚¹ã‚’ã™ã‚‹ã¨ã„ã†æ–¹å‘ã‚‚ã‚ã‚Šã ãªã¨è€ƒãˆã¦ã„ã¾ã™ã€‚
